<div class="row">
  <div id="ela_chart" class="span6"></div>
  <div id="math_chart" class="span6"></div>
</div>
<div id="row">
  <% @data.each do |subject| %>
  <h2><%= subject[:name] %></h2>
  <table class="table table-bordered table-striped table-condensed tablesorter">
    <thead>
      <tr>
        <th>Grade</th>
        <th>NYS Exam</th>
        <th>Benchmark Average</th>
        <th>Predictive Average</th>
        <th>Progress Based on Benchmark</th>
        <th>Progress Based on Predictive</th>
      </tr>
    </thead>
    <tbody>
      <% subject[:data].each do |row| %>
      <tr>
       <% row.each do |data| %>
        <td><%= data %></td>
       <% end %>
      </tr>
      <% end %>
    </tbody>
  </table>
  <% end %>
</div>
<div class="row">
  <div id="ela_bar" class="span6"></div>
  <div id="math_bar" class="span6"></div>
</div>
<div id="row">
  <% @data_for_each_subject.each do |subject| %>
  <h2><%= subject[:name] %></h2>
  <table class="table table-bordered table-striped table-condensed tablesorter cep-subject-breakdown <%= subject[:name].to_class %>" id="<%= subject[:name].to_class %>-benchmark-breakdown">
    <thead>
      <tr class="terms_and_tests">
        <th>&nbsp;</th>
        <th colspan="2">NYS ELA</th>
        <th colspan="2">NYS Math</th>
        <th colspan="3">T1MP1</th>
        <th colspan="3">T1MP2</th>
        <th colspan="3">T1MP3</th>
        <th colspan="3">T1MP4</th>
        <th colspan="3">T1MP5</th>
        <th colspan="3">T1MP6</th>
      </tr>
      <tr class="subgroups" id="<%= subject[:name].to_class %>-subgroup-header">
        <th>&nbsp;</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>ALL</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
        <th>ALL</th>
        <th>LTE</th>
        <th>LTM</th>
      </tr>
    </thead>
    <tbody>
      <% subject[:data].each do |row| %>
      <tr class="<%= row[0].to_class %>">
      <% row.each_with_index do |data, index| %>
        <td class="<%= @column_titles[index].is_a?(String) ? @column_titles[index] : @column_titles[index].values.join(' ') %>" <% if @column_titles[index].is_a? Hash %><% @column_titles[index].each_pair do |key, value| %> data-<%= key %> = "<%= value %>" <% end %><% end %> data-grade = "<%= row[0].to_class.gsub('grade', '') %>" data-subject = "<%= subject[:name].to_class %>">
          <%= data %>
        </td>
      <% end %>
      </tr>
      <% end %>
    </tbody>
  </table>
  <% end %>
</div>

<script type="text/javascript">
  google.load('visualization', '1.0', {'packages':['corechart']});
  google.setOnLoadCallback(drawCharts);

  function drawCharts (){
    $.getJSON('/api/lowest-third', function(dataSet) {
      drawLowestThirdPieChart(dataSet, 'ela', 'ela_chart', 470, 300);
      drawLowestThirdPieChart(dataSet, 'math', 'math_chart', 470, 300);
      drawLowestThirdAverage(dataSet, 'ela', 'ela_bar', 470, 400);
      drawLowestThirdAverage(dataSet, 'math', 'math_bar', 470, 400);
    })
  };

  $(document).ready(function(){
    $('table tbody tr > td').each(
      function(i,e){
        var value = $(e).text()
        if (value < 0) {
          $(e).css('color', 'red')
        } else if (value > 0 && value < 50) {
          $(e).css('color', 'green')
        }
      }
    );
  });
</script>